import{fs as e,chalk as t}from"@vuepress/utils";import{Logger as a,isAbsoluteUrl as r,isUrl as n,getAuthor as o,getDate as i,stripTags as l}from"vuepress-shared";import s from"gray-matter";import{isLinkHttp as c,removeEndingSlash as g,removeLeadingSlash as p}from"@vuepress/shared";const m=new a("vuepress-plugin-seo2"),u=(e,t)=>Object.entries(t).map((([e,t])=>({localePath:e,lang:t.lang}))).filter((t=>"string"==typeof t.lang&&t.lang!==e)),f=({frontmatter:e},{hostname:t},{options:{base:a}})=>{const{banner:o,cover:i}=e;if(o){if(r(o))return h(t,a,o);if(n(o))return o}if(i){if(r(i))return h(t,a,i);if(n(i))return i}return null},d=({content:e},{hostname:t},{options:{base:a}})=>{const o=/!\[.*?\]\((.*?)\)/giu.exec(e);return o?o.map((([,e])=>r(e)?h(t,a,e):n(e)?e:null)).filter((e=>null!==e)):[]},h=(e,t,a)=>`${c(e)?g(e):`https://${g(e)}`}${t}${p(a)}`,$=(e,t,a="",r="")=>{t in e&&(m.error(`"${t}" is removed${r?`, please use ${r} instead.`:" and no longer supported"}${a?`\n${a}`:""}`),r||delete e[t])},w=(e,{name:t,content:a,attribute:r=(["article:","og:"].some((e=>t.startsWith(e)))?"property":"name")})=>{a&&e.push(["meta",{[r]:t,content:a}])},y=(e,t,a)=>{const r=e.frontmatter.head||[],n=((e,t,a)=>{const{isArticle:r=(e=>Boolean(e.filePathRelative&&!e.frontmatter.home))}=t,{options:{base:n},siteData:l}=a,{frontmatter:{author:s,time:c,date:g=c,tag:p,tags:m=p},data:{git:$={}}}=e,w=l.locales[e.pathLocale]?.title||l.title||l.locales["/"]?.title||"",y=!1===s?[]:o(s||t.author),{updatedTime:b}=$,v=b?new Date(b).toISOString():"",S=Array.isArray(m)?m:"string"==typeof p?[p]:[],D=e.title,x=f(e,t,a),I=d(e,t,a),O=u(e.lang,l.locales);let P="";if(g instanceof Date)P=new Date(g).toISOString();else if(g){const e=i(g);e&&e.value&&(P=e.value.toISOString())}const _=x||I[0]||t.fallBackImage||"";return{"og:url":h(t.hostname,n,e.path),"og:site_name":w,"og:title":D,"og:description":e.frontmatter.description||t.autoDescription&&e.frontmatter.summary||"","og:type":r(e)?"article":"website","og:image":_,"og:updated_time":v,"og:locale":e.lang,"og:locale:alternate":O.map((({lang:e})=>e)),...t.restrictions?{"og:restrictions:age":t.restrictions}:{},...t.twitterID?{"twitter:creator":t.twitterID}:{},..._?{"twitter:card":"summary_large_image","twitter:image:alt":D}:{},"article:author":y[0]?.name,"article:tag":S,"article:published_time":P,"article:modified_time":v}})(e,t,a),l=((e,t,a)=>{const{isArticle:r=(e=>Boolean(e.filePathRelative&&!e.frontmatter.home))}=t,{frontmatter:{author:n,time:l,date:s=l},data:{git:c={}}}=e,g=!1===n?[]:o(n||t.author),{updatedTime:p}=c,m=p?new Date(p).toISOString():"",u=e.title,h=f(e,t,a),$=d(e,t,a);let w="";if(s instanceof Date)w=new Date(s).toISOString();else if(s){const e=i(s);e&&e.value&&(w=e.value.toISOString())}return r(e)?{"@context":"https://schema.org","@type":"NewsArticle",headline:u,image:$.length?$:[h||t.fallBackImage||""],datePublished:w,dateModified:m,author:g.map((e=>({"@type":"Person",...e})))}:null})(e,t,a),s=t.ogp?t.ogp(n,e,a):n,c=t.jsonLd?t.jsonLd(l,e,a):null,p=((e,t)=>"function"==typeof t.canonical?t.canonical(e):"string"==typeof t.canonical?`${g(t.canonical)}${e.path}`:null)(e,t),m=((e,t)=>u(e.lang,t.siteData.locales).map((({lang:t,localePath:a})=>({lang:t,path:`${a}${e.path.replace(e.pathLocale,"")}`}))))(e,a);((e,t)=>{for(const a in t)switch(a){case"article:tag":t["article:tag"].forEach((t=>w(e,{name:"article:tag",content:t})));break;case"og:locale:alternate":t["og:locale:alternate"].forEach((a=>{a!==t["og:locale"]&&w(e,{name:"og:locale:alternate",content:a})}));break;default:t[a]&&w(e,{name:a,content:t[a]})}})(r,s),((e,t)=>{t&&e.push(["script",{type:"application/ld+json"},JSON.stringify(t)])})(r,c),((e,t)=>{t&&e.push(["link",{rel:"canonical",href:t}])})(r,p),((e,t)=>{t.forEach((({lang:t,path:a})=>{e.push(["link",{rel:"alternate",hreflang:t,href:a}])}))})(r,m),t.customHead&&t.customHead(r,e,a),e.frontmatter.head=r},b=(a,r=!1)=>n=>{r&&(e=>{$(e,"seo","","ogp"),$(e,"customMeta","","customHead")})(a),n.env.isDebug&&m.info(`Options: ${a.toString()}`);const o={name:"vuepress-plugin-seo2"};return a.hostname?{...o,extendsPage:(e,t)=>{var r;e.frontmatter.description||(e.frontmatter.summary=l(e.excerpt)||(r=e.content,r?((e="")=>e.replace(/<\/?.+?\/?>/g,""))(s(r).content).replace(/!\[(.*?)\]\(.*?\)/gm,"").replace(/```([\s\S]*?)```/g,"").replace(/^\s*:::\s*$/gm,"").replace(/^\s*:::\s*(.+?)(?:\s+(.*))?$/gm,"$2").replace(/^# (.*)$/gm,"$1").replace(/^#{1,6} (.*)$/gm,"$1").replace(/^\s*[-*+] (.*)$/gm,"$1; ").replace(/^\s*>+(.*)$/gm,'"$1"').replace(/(^|[^\\])\[(.*?)\]\(.*?\)/gm,"$1$2").replace(/`{1,2}([^`])(.*?)`{1,2}/g,"$1$2").replace(/~~(.*?)~~/g,"").replace(/(^|[^\\])([*|_]{1,2})(.*?)([^\\])\2/gm,"$1$3$4").replace(/<\/?.+?\/?>/g,"").split("\n").map((e=>e.trim())).join("\n").replace(/(?:\r?\n)+/g," ").replace(/ +/g," ").trim():"").slice(0,180)||""),y(e,a,t)},onGenerated:t=>(async t=>{m.load("Generating robots.txt");const a=t.public("robots.txt");let r=e.existsSync(a)?await e.readFile(a,{encoding:"utf8"}):"";r&&!r.includes("User-agent")?(m.error(),m.update("robots.txt seems invalid!")):(r+="\nUser-agent:*\nDisallow:\n",await e.writeFile(t.dest("robots.txt"),r,{flag:"w"}),m.succeed())})(t.dir)}:(m.error(`Option ${t.magenta("hostname")} is required!`),o)};export{b as default,b as seoPlugin};
//# sourceMappingURL=index.js.map
